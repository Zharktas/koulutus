<!DOCTYPE html>
<html>
  <head>
    <title>js</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href='http://fonts.googleapis.com/css?family=Bree+Serif' rel='stylesheet' type='text/css'>
		<link href="../../assets/css/slides.css" rel="stylesheet">
		<link href="../../assets/css/tamplr.css" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="http://gnab.github.io/remark/downloads/remark-latest.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
  </head>
  <body>
    <textarea id="source">class: center, middle

# JavaScript

.yhdensivunversio[
[Yhden sivun versio](./all.html)
]

---

## JavaScript

* JavaScript on ohjelmointikieli erityisesti web-sovellusten selainpään
  toiminnallisuuden toteuttamiseen

* Käytännössä ainoa vaihtoehto suorittaa ohjelmia selaimessa ilman
  selain-plugineja

* Nykyään myös muuta käyttöä kuin selainpään ohjelmointi

* *"Maailman väärinymmärretyn ohjelmointikieli"*

---

## JavaScriptin historiaa

* JavaScript kehitettiin Netscapella vuonna 1995
    * Ilmestyi ensimmäisen kerran Netscape 2.0 selaimeen

* JavaScript on ECMA Script -spesifikaation toteutus
    * JavaScript toteutuksissa on kuitenkin eroja selainten välillä
    * On olemassa myös muita kieliä, jotka perustuvat ECMA Scriptiin (mm. ActionScript 3)

* JavaScriptillä ei nimestään huolimatta ole mitään tekemistä Javan kanssa
    * JavaScript ei itseasiassa ole kielen alkuperäinen nimi
        * alkuperäinen nimi oli Mocha
        * seuraava nimi oli LiveScript
    * Nimi muutettiin JavaScriptiksi markkinointisyistä

---

## JavaScriptin historiaa

* JavaScriptin merkitys ohjelmointikielenä on kasvanut huomattavasti
viimeisen 5 vuoden aikana web-sovellusten yleistymisen myötä.

* JavaScript on edelleen ainoa hyvin tuettu selainpuolen ohjelmointikieli

* Muitakin yrityksiä on, kuten Googlen Dart

* Yleistä on myös kääntäminen JavaScriptille
    * CoffeeScript
    * WebGL:n myötä myös C-kielellä tehtyjä ohjelmia on käännetty JavaScriptille

---

## Isäntäympäristö

* JavaScript tarvitsee aina isäntäympäristön
    * Web-selain
    * Node.js

* Isäntäympäristö tarjoaa JavaScriptille joukon isäntäolioita
    * JavaScript on tarkoitettu näiden olioiden muokkaamiseen
    * Suoraa pääsyä esimerkiksi laitteistoajureihin ei ole

* Isäntäoliot ovat määritetty kielestä erillään
    * Selain tarjoaa erilaisen ympäristön JS-koodille kuin node.js

---

## JavaScript ja HTML

* JavaScript-koodia voidaan liittää HTML-dokumenttiin `<script>`-tagilla

* Joko suoraan `<script>`-tagin sisään

```html
<script>
  alert("Tämä on JavaScript-koodia!");
</script>
```

* Tai lataamalla erillinen JavaScript-tiedosto

```html
<script src="./script.js"></script>
```

---

<h2 class="harjoitus">Harjoitus</h2>

* Avaa plunk http://plnkr.co/edit/FqutOKVfm4xkR4dt7B2I
ja suorita se.

Sen HTML-sivulla on `button`, jolla on `onclick`-attribuutti:

```html
<button id="nappi" onclick="painallus()">Paina tästä!</button>
```

Kun nappia painaa, kutsutaan `painallus`-nimistä funktiota,
joka on määritelty `script.js`-tiedostossa.
Funktion sisältö määritellään aaltosulkujen `{ ... }` sisällä.

* Muokkaa `painallus`-funktiota siten, että klikkauksen
jälkeen nappi "disabloidaan" eli laitetaan pois päältä.
Saat toteutettua sen lisäämällä funktioon rivit:

```javascript
var nappi = document.getElementById('nappi');
nappi.disabled = true;
```

---

## Kielen perusteet

* JavaScript on
    * dynaamisesti tyypitetty
    * prototyyppipohjainen
    * tulkattava kieli

* JavaScript on myös ehkä yksi väärin ymmärretyimmistä ohjelmointikielistä.

* Kieli sisältää paljon tutun näköisiä asioita, mutta ulkonäkö voi pettää!
    * Samat avainsanat eivät välttämättä tee samoja asioita kuin jossain toisessa kielessä.
    * Ota selvää ja opettele, niin vältät pahimmat miinat!


---

## Muuttujat

* JavaScriptin *muuttujat* määritellään avainsanalla `var`
    * `var` `MUUTTUJAN_NIMI` `=` `MUUTTUJAN_ARVO` `;`

```javascript
var totuusarvo = true;
var toinenTotuusarvo = false;

var x = 5;
var y = 6.8;
var z = -100;

var teksti = "moi";
var toinenTeksti = 'yksöishipsut';
```

* Sijoitus jo olemassaolevaan muuttujaan ilman `var`:ia

```javascript
teksti = 100;
```

* Mitä tapahtuu jos muuttujan määrittelystä unohtaa `var`-avainsanan
  pois?


* [W3Schools: JavaScript Variables](http://www.w3schools.com/js/js_variables.asp)

---

## Perustietotyypit

* Totuusarvo (Boolean)
* Lukuarvo (Number)
    * Ei erillistä tyyppiä kokonaisluvuille
* Merkkijono (String)
    * Yksittäinenkin merkki on merkkijono
* `undefined`
* `null`

---

## Operaattorit

* JavaScriptin *operaattorit* ovat samantapaisia kuin monessa muissa
  kielissä

* Aritmeettiset operaattorit `+` `-` `*` `/` `%` `++` `--`

```javascript
var x = 5 + 5;
```

```javascript
var y = x * 2 - 1;
```

```javascript
x++;
```

* Merkkijonoja voidaan liittää toisiinsa `+`-operaattorilla

```javascript
var nimi = "Anna";
var tervehdys = "Moi " + nimi + "!";
```

[W3Schools: JavaScript Operators](http://www.w3schools.com/js/js_operators.asp)

---

<h2 class="harjoitus">Harjoitus</h2>

JavaScript-lauseita voi testailla mm. selaimen kehitystyökalujen
  *Console*-välilehdellä

* Avaa konsoli ja kokeile luoda JavaScript-muuttujia ja tehdä vaikkapa
  laskutoimituksia

```javascript
var x = 5;

x + 100 * 2

// jne.
```

* Voit myös vaikkapa etsiä joltain HTML-sivulta elementin jolla on `id`
  ja tyhjentää sen sisällön kirjoittamalla saman sivun konsoliin

```javascript
document.getElementById('ELEMENTIN_ID').innerHTML = '';
```




---

## IF

* JavaScriptin kontrollirakenteet ovat samantapaisia kuin monessa muussa
  ohjelmointikielessä

* Ehtolause `if`

```javascript
var hinta = 2;

if (hinta < 10) {
  alert("Hinta on halpa");
}
```

* Ja-operaattori `&&`, tai-operaattori `||`

```javascript
if (tunti >= 9 && tunti < 21) {
  alert("Kauppa on auki");
}
```

```javascript
if (hinta > 10 || tunti > 21) {
  alert("Kalja jää ostamatta");
}
```

---

## IF-ELSE

```javascript
if (x === 5 && y < 2) {
  alert("jee");
}
else {
  alert("buu");
}
```

* [W3Schools: if...else](http://www.w3schools.com/js/js_if_else.asp)

---

## Silmukat

* `while`

```javascript
while (x < 10) {
  console.log(x);
  x += 2;
}
```

* `for`

```javascript
for (var i=0; i < 10; ++i) {
  console.log(i);
}
```

* W3Schools:
[for](http://www.w3schools.com/js/js_loop_for.asp) ja
[while](http://www.w3schools.com/js/js_loop_while.asp)

---

## Vertailu

* Vertailuoperaattoritkin näyttävät ensimmäkseen samoilta kuin monessa muussa kielessä
    * `<` `>` `<=` `>=`

* **mutta** erityisesti yhtäsuuruusvertailun kanssa on oltava
tarkkana

* Operaattori `==` testaa ovatko arvot mahdollisen tyyppimuunnoksen
  jälkeen samat
    * johtaa outouksiin, esimerkki:

```javascript
'' == '0' // false
 0 == ''  // true
 0 == '0' // true
```

* Operaattori `===` sen sijaan tarkastaa aidon yhtäsuuruuden
    * Kannattaa lähes aina käyttää sitä
    * Sama operaattoreille `!=` ja `!==`

---

## Funktiot

* Funktiot on tapa jakaa toiminnallisuutta osiin

* Esim. määrittelemme funktion nimeltä `laskeSumma` joka ottaa kaksi
  *parametria* nimeltä `a` ja `b`, laskee niiden summan ja *palauttaa*
tuloksen `return`-lauseella:

```javascript
function laskeSumma(a, b) {
  return a + b;
}
```

* Funktiota kutsutaan antamalla funktion nimi jonka jälkeen sulut `()`.
  Sulkujen sisällä mahdolliset parametrit pilkuin eroteltuina.

```javascript
var summa = laskeSumma(4, 17);
```

* Funktion paluuarvo tallennetaan yllä muuttujaan `summa`

* [W3Schools: JavaScript Functions](http://www.w3schools.com/js/js_functions.asp)

---

## Funktion määrittely

* Funktioiden määrittelyyn on kaksi vaihtoehtoista syntaksia:

```javascript
function laskeSumma(a, b) {
  return a + b;
}
```

```javascript
var laskeSumma = function(a, b) {
  return a + b;
};

```

---

<h2 class="harjoitus">Harjoitus</h2>

* Avaa jälleen plunk http://plnkr.co/edit/FqutOKVfm4xkR4dt7B2I
tai jatka siitä mihin viimeksi jäit

* Toteuta laskuri, joka pitää kirjaa siitä kuinka monta kertaa
  käyttäjä on nappia painanut.
  Näytä painallusten lukumäärä web-sivulla.

Voit luoda vaikkapa (globaalin) muuttujan:

```javascript
var painalluksia = 0;
```

ja aina klikatessa kasvattaa sitä `++`-operaattorilla:

```javascript
painalluksia++;

```

* Voit vielä näyttää onnittelutekstin kun käyttäjä saa 10 klikkausta
  täyteen

---

## Javascript-oliot

* Olioiden avulla JavaScriptin perustietotyypeistä voidaan koostaa suurempia
  kokonaisuuksia

* Olio on joukko avain-arvo-pareja, joissa avain on merkkijono ja
  arvo mitä vain: perustietotyyppi, funktio, toinen olio, ...

* Esimerkki:

```javascript
var viesti = {
  teksti: "Moi kaikki",
  tykkayksia: 43,
  laheta: function() {}
};

// Olion attribuuttiin voidaan viitata joko . tai [] syntaksilla
var v1 = viesti.teksti;
var v2 = viesti['teksti'];

// Myös uusia attribuutteja voidaan lisätä
viesti.uusi = "hehe";
```

* [W3Schools: JavaScript Objects](http://www.w3schools.com/js/js_objects.asp)

---

## Taulukko

* JavaScriptissä on myös taulukko-tietotyyppi (Array)

* Indeksoitava lista erityyppisiä alkioita

* Esim.

```javascript
var juttuja = [200, true, "Moi!"];

// Haetaan ensimmäinen (nollas) alkio, eli 200
var x = juttuja[0];

// Vaihdetaan alkio toiseksi
juttuja[1] = 50;

// Lisätään uusi alkio
juttuja.push("heh");
```

* [W3Schools: JavaScript Arrays](http://www.w3schools.com/js/js_arrays.asp)
ja [Array Methods](http://www.w3schools.com/js/js_array_methods.asp)

---

## DOM

* *DOM* (*Document Object Model*) on web-selaimen tarjoama
  ohjelmointirajapinta HTML (ja XML ja SVG) -dokumenttien muokkaamiseen
    * Selain sallii JavaScript-koodin muokata dokumentin tilaa rajapinnan läpi

* DOM tarjoaa dokumentista rakenteisen esityksen
    * Puu, joka koostuu solmuista (node)
    * Solmuja voi muokata, lisätä ja poistaa ohjelmallisesti

* Tarjoaa rajapinnan myös tapahtumakäsittelyyn
    * Jokaisen DOM-puun solmuun voi liittyä tapahtumakäsittelijöitä
    * Tapahtumakäsittelijöillä hoidetaan mm. käyttäjäinteraktio

---

## document

* DOM-rajapinta tarjoaa olion nimeltä `document`, jonka
  kautta HTML-dokumenttia on mahdollista manipuloida ohjelmallisesti

* `document`:n kautta pääsee käsiksi kaikkiin dokumentissa oleviin HTML-elementteihin

* Esim. haetaan elementti id:n perusteella ja muutetaan sen sisältö
sijoittamalla `innerHTML`-attribuuttiin uusi teksti

```javascript
var ele = document.getElementById('joku');
ele.innerHTML = "heippahei";
```

* [W3Schools: DOM Document](http://www.w3schools.com/js/js_htmldom_document.asp)

---

## DOM Elements

* Kaikki HTML-elementit näkyvät DOM:n kautta `Element`-olioina

* Element-olioilla on erilaisia metodeja ja attribuutteja,
joiden avulla elementtiä voi käsitellä

* Esim. luodaan uusi elementti ja lisätään se olemassaolevan elementin
  lapseksi:

```javascript
var a = document.createElement('a');
a.setAttribute('href', 'http://www.example.com');
a.innerHTML = 'Linkki';

var ele = document.getElementById('joku');
ele.appendChild(a);

```

* [W3Schools: HTML DOM Element Object](http://www.w3schools.com/jsref/dom_obj_all.asp)

---

## querySelector

* `document` -olion kautta voi hakea elementtejä muutenkin kuin id:n
  perusteella

* `document.querySelector` ottaa parametrikseen CSS-säännöistä tutun
  valitsimen ja palauttaa ensimmäisen osuman

```javascript
var iso = document.querySelector('.iso');
```

* `document.querySelectorAll` palauttaa kaikki osumat taulukkona

```javascript
var isot = document.querySelectorAll('.iso');

for (var i=0; i<isot.length; ++i) {
  // ...
}
```

* [W3Schools: document.querySelector](http://www.w3schools.com/jsref/met_document_queryselector.asp)
ja
[querySelectorAll](http://www.w3schools.com/jsref/met_document_queryselectorall.asp)

---

## DOM-tapahtumat

* Elementit lähettävät *tapahtumia* (*events*)
    * Esim. elementin klikkaaminen aiheuttaa `click`-tapahtuman

* Tapahtumia voidaan kuunnella kolmella tavalla:
    * Kaikki esimerkit kutsuvat funktiota `painallus` klikattaessa

1. HTML:ssä elementin `onXXX`-attribuutilla
```html
<button id="nappi" onclick="klikkaus()">Nappi</button>
```

2. JavaScriptissä DOM-elementin `onXXX`-attribuutilla
```javascript
var nappi = document.getElementById('nappi');
nappi.onclick = klikkaus;
```

3. JavaScriptissä DOM-elementin `addEventListener`-metodilla
```javascript
var nappi = document.getElementById('nappi');
nappi.addEventListener('click', klikkaus);
```

---

## DOM-tapahtumat

* ... kahdessa jälkimmäisessä tavassa on se hyvä puoli, että kutsuttava
  funktio saa parametrikseen *tapahtuma-olion*

* Tapahtumaolion avulla voidaan mm. perua tapahtuman
  oletustoiminnallisuus
    * esim. estää linkin klikkaus

```javascript
linkki.onclick = klikkaus;

function klikkaus(event) {
  event.preventDefault();
}
```

---

## Joitain tapahtumatyyppejä

|Tapahtuma|Selitys|
|:--------|:------|
|`click`|Klikkaus (tai kosketusnäytön "täppäys")|
|`mousemove`| Kursori liikahti elementin päällä |
|`change`| Elementin (esim. tekstikentän) arvo muuttui. Tapahtuu vasta elementin muututtua ei-aktiiviseksi |
|`input` | Sama kuin yllä, mutta tapahtuu heti kuin arvo muuttuu |
|`submit` | Lomake (form) lähetettiin |
|`load` | Elementti latautui. Esim. `<body onload="sivuLadattu()>` |

* [W3Schools: HTML DOM Events](http://www.w3schools.com/jsref/dom_obj_event.asp)

---

## Ajax

* Termillä [Ajax](https://developer.mozilla.org/en-US/docs/AJAX)
  tarkoitetaan joukkoa teknologioita,
  joiden avulla voidaan ladata uutta sisältöä web-sivulle
  lataamatta koko sivua uudelleen

* Nimi Ajax (Asyncronous JavaScript And XML) viittaa alkuperäiseen
  käyttötarkoitukseen XML-dokumenttien siirtämisessä

* Ajaxilla voidaan kuitenkin siirtää mitä tahansa dataa

* Keskiössä selaimen tarjoama `XMLHttpRequest`-olio

---

## XMLHttpRequest

* `XMLHttpRequest`-olion avulla voidaan web-selaimelta tehdä ~mielivaltaisia HTTP-pyyntöjä palvelimelle

```javascript
  var xhr = new XMLHttpRequest();
  xhr.open('GET', '/resurssi/palvelimella');
  xhr.onload = function(e) {
    if (this.status === 200) {
      alert(e.response);
    }
  }
  xhr.send();
```

---

## XMLHttpRequest

* Ajax-pyynnöissä voidaan käyttää kaikkia HTTP-metodeja
    * `GET`, `POST`, `PUT`, `DELETE`, ...

* Ja asettaa otsikkotietoja
    * [Tietyt otsikkotiedot](http://www.w3.org/TR/XMLHttpRequest/#the-setrequestheader%28%29-method)
      tosin on rajoitettu ainoastaan selaimen kirjoitettavaksi,
      eikä niitä voi asettaa `XMLHttpRequest`-olion kautta
        * Esim. `Host`, `Referer`, `User-Agent`, `Cookie`, ...
        * `Sec-` -alkuiset

```javascript
xhr.setRequestHeader('user-agent', 'salainen agentti');
```
```
> Refused to set unsafe header "user-agent"

```

</textarea>
    <script>
      "use strict";
      $(document).ready(function() {
        remark.create();
      });
    </script>
  </body>
</html>

